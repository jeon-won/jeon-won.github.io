{"componentChunkName":"component---src-templates-post-jsx","path":"/system/backup/datadomain-replication-error/","result":{"data":{"site":{"siteMetadata":{"title":"jeonwon.dev","author":"Jeon Won"}},"markdownRemark":{"id":"4091a7ea-f611-5951-aeb5-09b0d3f98b10","excerpt":"문제 A기관에 Avamar + DataDomain, B기관에 Avamar + DataDomain 설치 후 A기관의 백업 데이터를 B기관으로 복제(Replication)하려 함 Avamar 백업 데이터는 잘 복제되지만, DataDomain…","html":"<h2 id=\"문제\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C\" aria-label=\"문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제</h2>\n<ul>\n<li>A기관에 Avamar + DataDomain, B기관에 Avamar + DataDomain 설치 후 A기관의 백업 데이터를 B기관으로 복제(Replication)하려 함</li>\n<li>Avamar 백업 데이터는 잘 복제되지만, DataDomain 백업 데이터는 복제되지 않고 오류 발생</li>\n</ul>\n<h2 id=\"증상\" style=\"position:relative;\"><a href=\"#%EC%A6%9D%EC%83%81\" aria-label=\"증상 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>증상</h2>\n<ul>\n<li>복제 작업 실행 시 Avamar와 DataDomain 간 세션 수립이 되지만 곧 끊어짐</li>\n<li>복제 작업 실행 전엔 Source Avamar와 Destination DataDomain 간 ping 송수신, SSH 연결 등의 통신이 원활히 되지만 복제 작업을 실행하면 ping 응답이 없고 SSH 연결도 되지 않음</li>\n<li>두 기관의 방화벽 로그를 조회해보니 허용로그가 있고 차단로그는 발견되지 않음...</li>\n</ul>\n<h2 id=\"해봤던-삽질들\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EB%B4%A4%EB%8D%98-%EC%82%BD%EC%A7%88%EB%93%A4\" aria-label=\"해봤던 삽질들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해봤던 삽질들</h2>\n<ul>\n<li>네트워크 대역폭 문제인가? 대역폭을 10Mbps까지도 줄여봤으나 해결 안 됨</li>\n<li>방화벽에 Avamar 및 DataDomain의 IP가 블랙리스트로 등록되어 있는가? No...</li>\n<li>DataDomain의 이더넷 케이블 불량인가? No...</li>\n<li>DataDomain의 이더넷 포트 고장인가? No...</li>\n<li>Avamar, DataDomain 둘 다 재기동 해볼까? 해봤으나 해결 안 됨</li>\n<li>Source DataDomain OS 버전은 6.1.1.20이고 Destination DataDomain OS 버전은 6.2.1.30인데, 미세한 버전 차이(?)로 인해 문제가 발생할 수 있는가? 당연히 No...</li>\n<li>두 기관 사이에 있는 상위기관의 통신장비 문제인가? No... (상위기관의 통신장비는 라우팅만 수행할 뿐 포트, 서비스, 시간대 및 대역폭에 따라 통신을 차단하지 않는 것 확인)</li>\n</ul>\n<h2 id=\"원인분석\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8%EB%B6%84%EC%84%9D\" aria-label=\"원인분석 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인분석</h2>\n<p>DataDomain 원격지 백업 작업 시작 후 Avamar Administrator에서 로그 확인 결과 <code class=\"language-text\">Replication failed: could not open connection to dest DDR</code> 에러 발생</p>\n<div class=\"gatsby-highlight\" data-language=\"log\"><pre class=\"language-log\"><code class=\"language-log\"><span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar <span class=\"token level error important\">FATAL</span> <span class=\"token operator\">&lt;</span><span class=\"token number\">0000</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span><span class=\"token number\">10608</span><span class=\"token operator\">></span>Replication failed<span class=\"token operator\">:</span> could not open connection to dest DDR DATA_DOMAIN_DOMAIN<span class=\"token punctuation\">,</span> dest LSU<span class=\"token operator\">:</span> avamar<span class=\"token operator\">-</span><span class=\"token number\">1234567890</span><span class=\"token punctuation\">,</span> handle<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> DDR result code<span class=\"token operator\">:</span> <span class=\"token number\">5037</span><span class=\"token punctuation\">,</span> desc<span class=\"token operator\">:</span> illegal operation\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar <span class=\"token level error important\">FATAL</span> <span class=\"token operator\">&lt;</span><span class=\"token number\">40009</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> DDR encountered errors<span class=\"token punctuation\">.</span>\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">9772</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Starting graceful <span class=\"token operator\">(</span>staged<span class=\"token operator\">)</span> termination<span class=\"token punctuation\">,</span> DDR_ERROR event received <span class=\"token operator\">(</span>fatal severity<span class=\"token operator\">)</span> <span class=\"token operator\">(</span>wrap<span class=\"token operator\">-</span>up stage<span class=\"token operator\">)</span>\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">0000</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Entering the <span class=\"token string\">'final'</span> phase of termination<span class=\"token punctuation\">,</span> DDR_ERROR need to exit<span class=\"token operator\">)</span>\n<span class=\"token date number\">2021/06/29</span><span class=\"token operator\">-</span><span class=\"token time number\">06:06:17.04880</span> <span class=\"token punctuation\">[</span>avtar<span class=\"token punctuation\">]</span>  INTERNAL <span class=\"token level error important\">ERROR</span><span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span><span class=\"token number\">0001</span><span class=\"token operator\">></span> assert error <span class=\"token operator\">(</span>result <span class=\"token operator\">=</span><span class=\"token operator\">=</span> MSG_ERR_NONE<span class=\"token operator\">)</span><span class=\"token punctuation\">,</span> <span class=\"token file-path string\">/local/jenkins/workspace/client_Rooster_SLES11-64/abs2/work/src/avtar/ade/adelib/interfaceade.cpp</span> line <span class=\"token number\">396</span>\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Error <span class=\"token operator\">&lt;</span><span class=\"token number\">5674</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Could not locate requested backup for replication\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Error <span class=\"token operator\">&lt;</span><span class=\"token number\">6655</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Replicate interrupted<span class=\"token punctuation\">.</span>\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">7925</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Restored <span class=\"token number\">0</span> bytes from selection<span class=\"token operator\">(</span>s<span class=\"token operator\">)</span> with <span class=\"token number\">0</span> bytes in <span class=\"token number\">0</span> files\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">7883</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Finished at <span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> KST<span class=\"token punctuation\">,</span> Elapsed time<span class=\"token operator\">:</span> <span class=\"token number\">0000h</span><span class=\"token operator\">:</span><span class=\"token number\">12m</span><span class=\"token operator\">:</span><span class=\"token number\">20s</span>\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">40176</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span> Multi<span class=\"token operator\">-</span>stream restore summary <span class=\"token operator\">(</span>current <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> max active <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> max cloned <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> total cloned <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ddr handle <span class=\"token number\">1</span><span class=\"token operator\">)</span><span class=\"token operator\">:</span> \n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">6149</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Error summary<span class=\"token operator\">:</span> <span class=\"token number\">5</span> errors<span class=\"token operator\">:</span> <span class=\"token number\">6655</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5674</span><span class=\"token punctuation\">,</span> <span class=\"token number\">40009</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span>\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">8468</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Sending wrapup message to parent\n<span class=\"token date number\">2021-06-29</span> <span class=\"token time number\">15:06:17</span> avtar Info <span class=\"token operator\">&lt;</span><span class=\"token number\">5314</span><span class=\"token operator\">></span><span class=\"token operator\">:</span> Command failed <span class=\"token operator\">(</span><span class=\"token number\">5</span> errors<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span> warnings<span class=\"token punctuation\">,</span> exit code <span class=\"token number\">10007</span><span class=\"token operator\">:</span> miscellaneous error<span class=\"token operator\">)</span></code></pre></div>\n<p>A기관의 Avamar에서 SSH 접속 후 ddpconnchk라는 툴로 B기관의 DataDomain 접속 테스트 해봤더니 RPC 오류 발생</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@avamar:/data01/home/admin/<span class=\"token comment\"># ./ddpconnchk -s DATA_DOMAIN_IP -u ddboost -p P@SsW0rd</span>\nDDP CLIENT LIBRARY VERSION <span class=\"token number\">3</span>:5:0:2-635767\n\nSERVER: DATA_DOMAIN_IP\n--------------------\n*** CONNECT SERVER TEST, DATA_DOMAIN_IP\nDDLOG: WARN: <span class=\"token punctuation\">[</span>1B50:9B0EA0<span class=\"token punctuation\">]</span> Port lookup <span class=\"token keyword\">for</span> program <span class=\"token number\">100003</span> failed. Retry number: <span class=\"token number\">1</span>\nDDLOG: WARN: <span class=\"token punctuation\">[</span>1B50:9B0EA0<span class=\"token punctuation\">]</span> clnt_process_a_send_job RPC error, Will fail all <span class=\"token function\">jobs</span> later <span class=\"token keyword\">for</span> <span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token number\">5</span>\n<span class=\"token comment\"># ... 생략</span>\nDDLOG: ERR: <span class=\"token punctuation\">[</span>1B50:9B0EA0<span class=\"token punctuation\">]</span> Port lookup <span class=\"token keyword\">for</span> program <span class=\"token number\">100003</span> failed.\n\n********************************************************\n** DDP connect FAILED\n**   Servername: DATADOMAIN_IP\n**   Username: svc_dd_boost\n**   Password: **************\n**   Error: rpc operation/connection failure\n**\n** - Verify OST is licensed and enabled on the server\n** - Verify username/passwd matches values\n**   configured on server\n** - Verify that access by this <span class=\"token function\">host</span> is allowed\n********************************************************\nDDP Connect Server Test FAILED</code></pre></div>\n<p>netstat 명령어 확인 결과 111번 포트 상태가 ESTABLISHED지만 Send-Q 값이 빠지지 않고 몇 분 후 상태가 변하면서 해제됨</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 원격지 복제 작업 걸어놓은 후 A기관의 Avamar에서 111번 포트 확인</span>\nadmin@avamar:~/<span class=\"token operator\">></span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-an</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">111</span>\ntcp        <span class=\"token number\">0</span>     <span class=\"token number\">60</span> AVAMAR_IP:44537     DATA_DOMAIN_IP:111        ESTABLISHED  <span class=\"token comment\"># B기관의 DataDomain과 연결되어 있음 but Send-Q 값이 줄어들지 않음...</span>\ntcp        <span class=\"token number\">0</span>      <span class=\"token number\">1</span> AVAMAR_IP:44528     DATA_DOMAIN_IP:111        SYN_SENT\n\n<span class=\"token comment\"># 시간이 꽤 지나면 ESTABLISHED → FIN_WAIT1 상태로 변경됨</span>\nadmin@avamar:~/<span class=\"token operator\">></span> <span class=\"token function\">netstat</span> <span class=\"token parameter variable\">-an</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token number\">111</span>\ntcp        <span class=\"token number\">0</span>      <span class=\"token number\">1</span> AVAMAR_IP:49740     DATA_DOMAIN_IP:111        FIN_WAIT1\n\n<span class=\"token comment\"># B기관의 DataDomain에서 111번 포트 확인</span>\nddboost@datadomain<span class=\"token comment\"># netstat</span>\nProto Recv-Q Send-Q Local Address           Foreign Address         State\ntcp        <span class=\"token number\">0</span>     <span class=\"token number\">32</span> DATA_DOMAIN_IP:111      AVAMAR_IP:44361         ESTABLISHED  <span class=\"token comment\"># A기관의 Avamar와 연결되어 있음 but Send-Q 값이 줄어들지 않음...</span>\ntcp        <span class=\"token number\">0</span>     <span class=\"token number\">32</span> DATA_DOMAIN_IP:111      AVAMAR_IP:44419         ESTABLISHED \ntcp        <span class=\"token number\">0</span>     <span class=\"token number\">32</span> DATA_DOMAIN_IP:111      AVAMAR_IP:44380         ESTABLISHED</code></pre></div>\n<p>iperf로 A기관의 Avamar → B기관의 DataDomain으로 데이터 전송 잘 되는 것 확인함</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sysadmin@datadomain<span class=\"token comment\"># net iperf server  # DataDomain에서 iperf Server 모드 실행</span>\n----------------------------------------------j--------------\nServer listening on TCP port <span class=\"token number\">5001</span>\nTCP window size:  <span class=\"token number\">256</span> KByte <span class=\"token punctuation\">(</span>default<span class=\"token punctuation\">)</span>\n------------------------------------------------------------\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token builtin class-name\">local</span> DATA_DOMAIN_IP port <span class=\"token number\">5001</span> connected with AVAMAR_IP port <span class=\"token number\">14376</span>\n<span class=\"token punctuation\">[</span> ID<span class=\"token punctuation\">]</span> Interval       Transfer     Bandwidth\n<span class=\"token punctuation\">[</span>  <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>  <span class=\"token number\">0.0</span>-10.0 sec   <span class=\"token number\">574</span> MBytes   <span class=\"token number\">480</span> Mbits/sec</code></pre></div>\n<p>복제 작업을 실행하지 않았을 때 traceroute 명령어로 A기관의 Avamar → B기관의 DataDomain 정상 도달 확인</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@avamar:~/<span class=\"token comment\"># traceroute -I DATA_DOMAIN_IP</span>\nNote: the <span class=\"token parameter variable\">-i</span> and <span class=\"token parameter variable\">-I</span> options were exchangedfor compability with LBL <span class=\"token function\">traceroute</span>\nUse <span class=\"token parameter variable\">-I</span> <span class=\"token keyword\">for</span> ICMP, and <span class=\"token parameter variable\">-i</span> <span class=\"token operator\">&lt;</span>ifname<span class=\"token operator\">></span> to specify the interface name\n<span class=\"token function\">traceroute</span> to DATA_DOMAIN_IP <span class=\"token punctuation\">(</span>DATA_DOMAIN_IP<span class=\"token punctuation\">)</span>, <span class=\"token number\">30</span> hops max, <span class=\"token number\">40</span> byte packets using ICMP\n <span class=\"token number\">1</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_BACKBONE_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">0.791</span> ms   <span class=\"token number\">0.740</span> ms   <span class=\"token number\">0.612</span> ms\n <span class=\"token number\">2</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_FAILOVER_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">0.947</span> ms   <span class=\"token number\">0.577</span> ms   <span class=\"token number\">0.496</span> ms\n <span class=\"token number\">3</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.640</span> ms   <span class=\"token number\">4.393</span> ms   <span class=\"token number\">3.013</span> ms              -<span class=\"token operator\">></span> 여기까지 A기관 통신장비\n <span class=\"token number\">4</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.632</span> ms   <span class=\"token number\">1.908</span> ms   <span class=\"token number\">6.154</span> ms            -<span class=\"token operator\">></span> 여기서부터 상위기관 통신장비\n <span class=\"token number\">5</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">5.667</span> ms   <span class=\"token number\">4.795</span> ms   <span class=\"token number\">2.980</span> ms\n <span class=\"token number\">6</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.834</span> ms   <span class=\"token number\">1.838</span> ms   <span class=\"token number\">5.145</span> ms\n <span class=\"token number\">7</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.080</span> ms   <span class=\"token number\">4.899</span> ms   <span class=\"token number\">3.812</span> ms\n <span class=\"token number\">8</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">3.283</span> ms   <span class=\"token number\">7.983</span> ms   <span class=\"token number\">6.874</span> ms\n <span class=\"token number\">9</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">5.754</span> ms   <span class=\"token number\">4.021</span> ms   <span class=\"token number\">1.940</span> ms\n<span class=\"token number\">10</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.118</span> ms   <span class=\"token number\">5.800</span> ms   <span class=\"token number\">4.956</span> ms\n<span class=\"token number\">11</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.671</span> ms   <span class=\"token number\">5.913</span> ms   <span class=\"token number\">4.803</span> ms\n<span class=\"token number\">12</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.723</span> ms   <span class=\"token number\">6.091</span> ms   <span class=\"token number\">4.984</span> ms\n<span class=\"token number\">13</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.893</span> ms   <span class=\"token number\">5.966</span> ms   <span class=\"token number\">4.859</span> ms            -<span class=\"token operator\">></span> 여기까지 상위기관 통신장비\n<span class=\"token number\">14</span>  B_SWITCH <span class=\"token punctuation\">(</span>B_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.242</span> ms   <span class=\"token number\">6.426</span> ms   <span class=\"token number\">5.318</span> ms              -<span class=\"token operator\">></span> 여기서부터 B기관 통신장비\n<span class=\"token number\">15</span>  DATA_DOMAIN_IP <span class=\"token punctuation\">(</span>DATA_DOMAIN_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">4.260</span> ms   <span class=\"token number\">4.238</span> ms   <span class=\"token number\">3.178</span> ms  -<span class=\"token operator\">></span> 정상 도달</code></pre></div>\n<p>but 복제 작업을 시작하면 도달 불가</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">root@avamar:~/<span class=\"token comment\"># traceroute -I DATA_DOMAIN_IP</span>\nNote: the <span class=\"token parameter variable\">-i</span> and <span class=\"token parameter variable\">-I</span> options were exchangedfor compability with LBL <span class=\"token function\">traceroute</span>\nUse <span class=\"token parameter variable\">-I</span> <span class=\"token keyword\">for</span> ICMP, and <span class=\"token parameter variable\">-i</span> <span class=\"token operator\">&lt;</span>ifname<span class=\"token operator\">></span> to specify the interface name\n<span class=\"token function\">traceroute</span> to DATA_DOMAIN_IP <span class=\"token punctuation\">(</span>DATA_DOMAIN_IP<span class=\"token punctuation\">)</span>, <span class=\"token number\">30</span> hops max, <span class=\"token number\">40</span> byte packets using ICMP\n <span class=\"token number\">1</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_BACKBONE_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">0.791</span> ms   <span class=\"token number\">0.740</span> ms   <span class=\"token number\">0.612</span> ms\n <span class=\"token number\">2</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_FAILOVER_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">0.947</span> ms   <span class=\"token number\">0.577</span> ms   <span class=\"token number\">0.496</span> ms\n <span class=\"token number\">3</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.640</span> ms   <span class=\"token number\">4.393</span> ms   <span class=\"token number\">3.013</span> ms      -<span class=\"token operator\">></span> 여기까지 A기관 통신장비\n <span class=\"token number\">4</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.989</span> ms   <span class=\"token number\">1.316</span> ms   <span class=\"token number\">7.284</span> ms    -<span class=\"token operator\">></span> 여기서부터 상위기관 통신장비\n <span class=\"token number\">5</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">6.761</span> ms   <span class=\"token number\">6.337</span> ms   <span class=\"token number\">14.864</span> ms\n <span class=\"token number\">6</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.574</span> ms   <span class=\"token number\">6.055</span> ms   <span class=\"token number\">4.946</span> ms\n <span class=\"token number\">7</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.084</span> ms   <span class=\"token number\">5.247</span> ms   <span class=\"token number\">4.066</span> ms\n <span class=\"token number\">8</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.347</span> ms   <span class=\"token number\">5.288</span> ms   <span class=\"token number\">4.180</span> ms\n <span class=\"token number\">9</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.546</span> ms   <span class=\"token number\">6.469</span> ms   <span class=\"token number\">5.360</span> ms\n<span class=\"token number\">10</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">4.273</span> ms   <span class=\"token number\">3.875</span> ms   <span class=\"token number\">3.190</span> ms\n<span class=\"token number\">11</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">3.214</span> ms   <span class=\"token number\">5.936</span> ms   <span class=\"token number\">4.826</span> ms\n<span class=\"token number\">12</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">3.856</span> ms   <span class=\"token number\">5.789</span> ms   <span class=\"token number\">2.686</span> ms\n<span class=\"token number\">13</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">4.453</span> ms   <span class=\"token number\">7.945</span> ms   <span class=\"token number\">6.836</span> ms   -<span class=\"token operator\">></span> 여기까지 상위기관 통신장비\n<span class=\"token number\">14</span>  * * *                                                   -<span class=\"token operator\">></span> B기관 Area에서 <span class=\"token function\">timeout</span> 발생. B기관 통신장비에서 가로막고 있는 것으로 추정<span class=\"token punctuation\">..</span>.\n<span class=\"token number\">15</span> ~ <span class=\"token number\">29</span> * * *\n<span class=\"token number\">30</span>  * * *</code></pre></div>\n<p>마찬가지로 복제 작업을 실행하지 않았을 때 traceroute 명령어로 B기관의 DataDomain → A기관의 Avamar 정상 도달 확인</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sysadmin@datadomain<span class=\"token comment\"># net route trace AVAMAR_IP</span>\n<span class=\"token function\">traceroute</span> to AVAMAR_IP <span class=\"token punctuation\">(</span>AVAMAR_IP<span class=\"token punctuation\">)</span>, <span class=\"token number\">30</span> hops max, <span class=\"token number\">60</span> byte packets\n <span class=\"token number\">1</span>  B_SWITCH <span class=\"token punctuation\">(</span>B_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">54.464</span> ms  <span class=\"token number\">54.837</span> ms  <span class=\"token number\">54.858</span> ms\n <span class=\"token number\">2</span>  B_SWITCH <span class=\"token punctuation\">(</span>B_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">0.655</span> ms  <span class=\"token number\">1.883</span> ms  <span class=\"token number\">1.905</span> ms    -<span class=\"token operator\">></span> 여기까지 B기관 통신장비\n <span class=\"token number\">3</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.375</span> ms  <span class=\"token number\">2.035</span> ms  <span class=\"token number\">2.052</span> ms  -<span class=\"token operator\">></span> 여기서부터 상위기관 통신장비\n <span class=\"token number\">4</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.630</span> ms  <span class=\"token number\">1.829</span> ms  <span class=\"token number\">2.023</span> ms\n <span class=\"token number\">5</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.796</span> ms  <span class=\"token number\">1.894</span> ms  <span class=\"token number\">1.897</span> ms\n <span class=\"token number\">6</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">1.964</span> ms  <span class=\"token number\">1.340</span> ms  <span class=\"token number\">2.638</span> ms\n <span class=\"token number\">7</span>  SERIAL_IP <span class=\"token punctuation\">(</span>SERIAL_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.005</span> ms  <span class=\"token number\">1.997</span> ms  <span class=\"token number\">2.016</span> ms  -<span class=\"token operator\">></span> 여기까지 상위기관 통신장비\n <span class=\"token number\">8</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.928</span> ms  <span class=\"token number\">2.992</span> ms  <span class=\"token number\">3.800</span> ms    -<span class=\"token operator\">></span> 여기서부터 A기관 통신장비\n <span class=\"token number\">9</span>  A_SWITCH <span class=\"token punctuation\">(</span>A_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">2.984</span> ms  <span class=\"token number\">3.983</span> ms  <span class=\"token number\">3.987</span> ms\n<span class=\"token number\">10</span>  AVAMAR_IP <span class=\"token punctuation\">(</span>AVAMAR_IP<span class=\"token punctuation\">)</span>  <span class=\"token number\">3.476</span> ms  <span class=\"token number\">3.497</span> ms  <span class=\"token number\">3.736</span> ms  -<span class=\"token operator\">></span> 정상 도달</code></pre></div>\n<p>but 원격지 백업 작업을 시작하면 도달 불가</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sysadmin@datadomain<span class=\"token comment\"># net route trace AVAMAR_IP</span>\n<span class=\"token function\">traceroute</span> to AVAMAR_IP <span class=\"token punctuation\">(</span>AVAMAR_IP<span class=\"token punctuation\">)</span>, <span class=\"token number\">30</span> hops max, <span class=\"token number\">60</span> byte packets\n <span class=\"token number\">1</span>  B_SWITCH <span class=\"token punctuation\">(</span>B_SWITCH<span class=\"token punctuation\">)</span>  <span class=\"token number\">12.280</span> ms  <span class=\"token number\">13.585</span> ms  <span class=\"token number\">13.606</span> ms  -<span class=\"token operator\">></span> B 기관 통신장비\n <span class=\"token number\">2</span>  * * *                                                 -<span class=\"token operator\">></span> <span class=\"token function\">timeout</span> 발생. B기관 통신장비에서 가로막고 있는 것으로 추정<span class=\"token punctuation\">..</span>.\n <span class=\"token number\">3</span> ~ <span class=\"token number\">29</span> * * *\n<span class=\"token number\">30</span>  * * *</code></pre></div>\n<p>이런 정황들을 봤을 때, B기관의 통신장비에서 통신을 가로막고 있는 느낌적인 느낌이...</p>\n<h2 id=\"원인\" style=\"position:relative;\"><a href=\"#%EC%9B%90%EC%9D%B8\" aria-label=\"원인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>원인</h2>\n<ul>\n<li>Source DataDomain의 백업 데이터를 Destination DataDomain으로 복제할 때 Source Avamar와 Destination DataDomain간 세션을 수립한 후 통신을 수행함</li>\n<li>이 때 두 서버간 SSH 연결이 가능해야 하며, RPC(원격 프로시저 호출) 프로토콜을 사용함</li>\n<li>그런데 침입방지시스템(IPS)에서 RPC를 침입으로 간주하여 차단했기 때문에 원격지 백업 데이터 복제 오류 발생</li>\n<li>알고보니 방화벽에만 포트 허용 설정이 되어 있었고 IPS에는 아무런 설정이 되어있지 않아 발생한 문제였음...</li>\n</ul>\n<h2 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결</h2>\n<p>침입방지시스템(IPS) 설정하여 해결 <del>너무 간단한 방법이었다니!</del></p>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n<ul>\n<li><a href=\"https://www.dell.com/support/kbdoc/ko-kr/000019734/avamar-replication-undocumented-but-required-port-ssh-port-22\">Avamar Replication - undocumented but required port (SSH / Port 22)</a></li>\n<li><a href=\"https://www.delltechnologies.com/asset/en-us/products/data-protection/technical-support/docu91808.pdf\">Dell EMC Data Domain® Security Configuration Guide 302-005-263 REV 03의 27Page</a>: DataDomain에서 사용하는 포트 설명</li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C\">문제</a></li>\n<li><a href=\"#%EC%A6%9D%EC%83%81\">증상</a></li>\n<li><a href=\"#%ED%95%B4%EB%B4%A4%EB%8D%98-%EC%82%BD%EC%A7%88%EB%93%A4\">해봤던 삽질들</a></li>\n<li><a href=\"#%EC%9B%90%EC%9D%B8%EB%B6%84%EC%84%9D\">원인분석</a></li>\n<li><a href=\"#%EC%9B%90%EC%9D%B8\">원인</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0\">해결</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0\">참고</a></li>\n</ul>","frontmatter":{"title":"DataDomain 백업 데이터 복제(Replication) 오류","description":"DataDomain 백업 데이터 복제(Replication) 오류","date":"February 20, 2022","tags":["system","backup"],"series":"시스템 관리","previewImage":"system.jpg","isPrivate":null}},"previous":null,"next":{"fields":{"slug":"/system/backup/avamar-administrator-backup-schedule-setting-error/"},"frontmatter":{"title":"Avamar Administrator 백업 스케쥴 설정 오류","isPrivate":null}}},"pageContext":{"id":"4091a7ea-f611-5951-aeb5-09b0d3f98b10","previousPostId":null,"nextPostId":"2f34b3a6-9b9f-5a17-8431-5b4cfa7901d0"}},"staticQueryHashes":[],"slicesMap":{}}