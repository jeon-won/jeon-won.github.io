{"componentChunkName":"component---src-templates-post-jsx","path":"/system/linux/migration-to-rockylinux9/","result":{"data":{"site":{"siteMetadata":{"title":"jeonwon.dev","author":"Jeon Won"}},"markdownRemark":{"id":"abbbc771-02f6-584b-bef6-cef69f320ff5","excerpt":"기술지원 종료된 CentOS 가상화 서버를 Rocky Linux 9 가상화 서버로 이관한 과정을 정리해본 글. 주요 절차 Rocky Linux 9 서버로 이관 작업 시에 거쳤던 절차는 아래와 같음. 가상화 서버 생성 Rocky Linux…","html":"<p><a href=\"https://www.reddit.com/r/linuxmasterrace/comments/rslqxo/centos_linux_8_end_of_life_december_31st_2021/\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.84662576687117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRrIAAABXRUJQVlA4IKYAAADQAwCdASoUAA8APtFUo0uoJKMhsAgBABoJZACdABKp0UINWbmhCgAA/uwmP109fXX8hI9K9wEuSLJKVqLd4rwAn9SMkKKdgOrsTCpZV8FPOaCBay7X7O6crgdtTj4ImJ2VKDGRAqSCLJfWwq614u9e2fkeRZYioiVfZ83PHJpfYnwje+b9UcglAyFtaXAyKSrP11fegwBCJU1Df7BsufqV9+bwkgAA'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"me installing rockylinux png\"\n        title=\"\"\n        src=\"/static/0fa0addb6a5c6943f521d08beb295d35/c1dc5/me-installing-rockylinux.png.webp\"\n        srcset=\"/static/0fa0addb6a5c6943f521d08beb295d35/94563/me-installing-rockylinux.png.webp 163w,\n/static/0fa0addb6a5c6943f521d08beb295d35/647a8/me-installing-rockylinux.png.webp 325w,\n/static/0fa0addb6a5c6943f521d08beb295d35/c1dc5/me-installing-rockylinux.png.webp 650w,\n/static/0fa0addb6a5c6943f521d08beb295d35/1e975/me-installing-rockylinux.png.webp 975w,\n/static/0fa0addb6a5c6943f521d08beb295d35/063bf/me-installing-rockylinux.png.webp 1300w,\n/static/0fa0addb6a5c6943f521d08beb295d35/fad48/me-installing-rockylinux.png.webp 1600w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></a></p>\n<p>기술지원 종료된 CentOS 가상화 서버를 Rocky Linux 9 가상화 서버로 이관한 과정을 정리해본 글.</p>\n<h2 id=\"주요-절차\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9A%94-%EC%A0%88%EC%B0%A8\" aria-label=\"주요 절차 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주요 절차</h2>\n<p>Rocky Linux 9 서버로 이관 작업 시에 거쳤던 절차는 아래와 같음.</p>\n<ol>\n<li>가상화 서버 생성</li>\n<li>Rocky Linux 9 설치 및 기본 설정</li>\n<li>데이터 최초 이관</li>\n<li>애플리케이션(WEB, WAS, DB 등) 기동 테스트</li>\n<li>데이터 최종 이관</li>\n<li>실제 서비스 IP로 변경</li>\n</ol>\n<p>데이터를 최초, 최종으로 두 번 나누어 이관한 이유는 애플리케이션 기동 테스트를 해보기 위함임. 최초 데이터 이관 후 애플리케이션 기동 테스트 성공하면 추후에 일정 잡은 후 최종 이관하면 되는 것이고, 실패하면 뭐... 이관 못 하는 거임 😭</p>\n<h2 id=\"1-가상화-서버-생성\" style=\"position:relative;\"><a href=\"#1-%EA%B0%80%EC%83%81%ED%99%94-%EC%84%9C%EB%B2%84-%EC%83%9D%EC%84%B1\" aria-label=\"1 가상화 서버 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 가상화 서버 생성</h2>\n<p>구 서버의 CPU 코어 수, 메모리 및 디스크 용량 등을 동등 이상으로 설정하여 신 서버 생성.</p>\n<h2 id=\"2-rocky-linux-9-설치-및-기본-설정\" style=\"position:relative;\"><a href=\"#2-rocky-linux-9-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EA%B8%B0%EB%B3%B8-%EC%84%A4%EC%A0%95\" aria-label=\"2 rocky linux 9 설치 및 기본 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Rocky Linux 9 설치 및 기본 설정</h2>\n<p>설치는 매우 쉬우니 설명 생략...</p>\n<h3 id=\"유저-생성\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EC%A0%80-%EC%83%9D%EC%84%B1\" aria-label=\"유저 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유저 생성</h3>\n<p><code class=\"language-text\">useradd -d /home/&lt;USER_NAME> -m &lt;USER_NAME> -s /bin/bash</code> 명령어로 기존 서버에 생성돼있는 유저 동일하게 생성.</p>\n<p>구 서버에 어떤 유저가 생성되어 있는지 모르겠다면 기존 서버의 <code class=\"language-text\">/etc/passwd</code> 파일을 열어서 UID 값이 1000 이상이면 유저 확인. UID 값이 1000 이상이면 대체로 <code class=\"language-text\">useradd</code> 명령어로 생성된 유저임.</p>\n<h3 id=\"임시-ip-부여\" style=\"position:relative;\"><a href=\"#%EC%9E%84%EC%8B%9C-ip-%EB%B6%80%EC%97%AC\" aria-label=\"임시 ip 부여 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>임시 IP 부여</h3>\n<p><code class=\"language-text\">nmtui</code> 명령어 등으로 임시 IP 부여. 신 서버에 IP를 부여하여 구 서버의 데이터를 넘겨받거나 테스트해보기 위함임.</p>\n<h3 id=\"네트워크-설정\" style=\"position:relative;\"><a href=\"#%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%84%A4%EC%A0%95\" aria-label=\"네트워크 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>네트워크 설정</h3>\n<p>신 서버의 OS 방화벽 설정이 필요한 경우 <code class=\"language-text\">firewall-cmd</code> 명령어로 알아서 적절히 설정.</p>\n<p>신 서버가 폐쇄망에 연결되어 있고 dnf 명령어로 패키지 설치가 필요한 경우 방화벽이나 IPS 장비 등에서 80, 443번 포트 통신을 허용해줘야 함.</p>\n<p>신 서버가 웹방화벽이나 망연계장비의 영향을 받는지도 확인.</p>\n<h3 id=\"호스트네임-설정\" style=\"position:relative;\"><a href=\"#%ED%98%B8%EC%8A%A4%ED%8A%B8%EB%84%A4%EC%9E%84-%EC%84%A4%EC%A0%95\" aria-label=\"호스트네임 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>호스트네임 설정</h3>\n<p><code class=\"language-text\">/etc/hostname</code> 파일을 열어서 호스트네임 적고 저장한 후 재기동하면 반영됨.</p>\n<p>호스트네임이 잘 바꼈는지 못 믿겠으면 <code class=\"language-text\">hostname</code> 명령어 실행해보면 됨.</p>\n<h3 id=\"ntp-설정\" style=\"position:relative;\"><a href=\"#ntp-%EC%84%A4%EC%A0%95\" aria-label=\"ntp 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NTP 설정</h3>\n<p>시간 동기화를 위해 NTP 설정.</p>\n<ol>\n<li><code class=\"language-text\">sudo dnf instal chrony</code> 명령어로 chrony 설치</li>\n<li><code class=\"language-text\">sudo systemctl enable chronyd --now</code> 명령어로 chrony 서비스 활성화. 잘 활성화 됐는지 못 믿겠으면 <code class=\"language-text\">sudo systemctl status chronyd</code> 명령어로 확인.</li>\n<li><code class=\"language-text\">/etc/chrony.conf</code> 파일을 열어 아래처럼 NTP 서버 추가</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">server time.bora.net iburst\nserver 기타_NTP_서버_주소 iburst</code></pre></div>\n<ol start=\"4\">\n<li><code class=\"language-text\">sudo systemctl restart chronyd</code> 명령어로 chrony 서비스 재시작</li>\n<li><code class=\"language-text\">chronyc sources -v</code> 명령어로 NTP 서버 동기화 상태 확인. NTP 서버 주소 앞에 <code class=\"language-text\">^*</code>라고 나타나면 정상임.\n<ul>\n<li>NTP가 잘 작동하지 않는다면 123 UDP 포트 접속 허용 설정 필요</li>\n<li><code class=\"language-text\">chronyc tracking</code> 명령어로 세부사항을 볼 수 있음</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"ulimit-open-files-값-설정\" style=\"position:relative;\"><a href=\"#ulimit-open-files-%EA%B0%92-%EC%84%A4%EC%A0%95\" aria-label=\"ulimit open files 값 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ulimit open files 값 설정</h3>\n<p>Rocky Linux 9 버전에서 하나의 프로세스가 열 수 있는 최대 파일 개수는 기본적으로 1024임.</p>\n<p><code class=\"language-text\">/etc/security/limits.conf</code> 파일에 아래 내용을 추가하여 확장함.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">*    soft    nofile    <span class=\"token number\">65535</span>  <span class=\"token comment\"># 특정 유저에 대해 설정하려면 * 대신 유저 이름 입력</span>\n*    soft    nproc     <span class=\"token number\">65535</span>\n*    hard    nofile    <span class=\"token number\">65535</span>\n*    hard    nproc     <span class=\"token number\">65535</span></code></pre></div>\n<h3 id=\"파일시스템-생성-및-마운트\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EB%A7%88%EC%9A%B4%ED%8A%B8\" aria-label=\"파일시스템 생성 및 마운트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일시스템 생성 및 마운트</h3>\n<p>디스크가 여러 개 들어가있거나 파티션이 여러 개 나눠져 있는 경우 기존 서버와 동일하게 볼륨그룹, 논리볼륨, 파일시스템 등 설정.</p>\n<p>Rocky Linux 9 설치 과정 중에 설정해도 되고, 설치 완료된 후에 설정하려는 경우 <a href=\"https://jeonwon.dev/system/linux/rockylinux9-filesystem-setting/\">Rocky Linux 9 파일시스템 설정 글</a> 참고.</p>\n<h2 id=\"3-데이터-최초-이관\" style=\"position:relative;\"><a href=\"#3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B5%9C%EC%B4%88-%EC%9D%B4%EA%B4%80\" aria-label=\"3 데이터 최초 이관 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 데이터 최초 이관</h2>\n<p><strong>기본적으로 이관한 데이터는...</strong></p>\n<ul>\n<li><code class=\"language-text\">/root</code> 및 <code class=\"language-text\">/home</code> 경로의 유저별 디렉터리에 저장된 <code class=\"language-text\">.bash_profile</code> 파일</li>\n<li><code class=\"language-text\">/etc/profile</code> 파일 내용 일부</li>\n<li>Java를 사용하는 경우 Java가 설치된 경로(보통 <code class=\"language-text\">.bash_profile</code> 파일 또는 <code class=\"language-text\">/etc/profile</code> 파일에 JAVA_HOME 경로가 명시되어 있음)</li>\n<li>WEB, WAS, DB 또는 기타 애플리케이션 등이 사용하는 경로</li>\n<li>cron에 등록된 명령어(root 또는 각 유저별로 로그인 후 <code class=\"language-text\">crontab -e</code> 명령어로 확인)</li>\n</ul>\n<p><strong>데이터 이관은 rsync 명령어로 하는 것이 좋음.</strong> 왜냐하면...</p>\n<ul>\n<li>파일(디렉터리) 소유자와 권한을 그대로 유지한 채로 이관할 수 있음</li>\n<li>증분 데이터를 이관하므로 최종 이관작업 시 작업시간을 줄일 수 있음</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># -a: 권한유지, -v: 자세한 정보 출력, -z: 압축전송 , -h: 휴먼이 알아보기 쉽게</span>\n<span class=\"token comment\"># --delete: 구 서버에 삭제된 데이터가 있으면 신 서버에서도 삭제함</span>\n<span class=\"token comment\"># --bwlimit: 최대 전송속도 설정. 단위는 KB/s. (네트워크 대역폭 이슈가 생길 것 같거나, EMS에서 네트워크 사용량 경고 날리는 게 싫으면 쓰면 될 듯)</span>\n$ <span class=\"token function\">rsync</span> <span class=\"token parameter variable\">-avzh</span> <span class=\"token parameter variable\">--delete</span> <span class=\"token operator\">&lt;</span>OLD_SERVER_PATH<span class=\"token operator\">></span> --log-file<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>LOG_FILE_PATH<span class=\"token operator\">></span> <span class=\"token parameter variable\">--bwlimit</span><span class=\"token operator\">=</span><span class=\"token number\">10240</span> <span class=\"token operator\">&lt;</span>NEW_SERVER_OS_ID<span class=\"token operator\">></span>@<span class=\"token operator\">&lt;</span>NEW_SERVER_IP<span class=\"token operator\">></span>:<span class=\"token operator\">&lt;</span>NEW_SERVER_PATH<span class=\"token operator\">></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 예: rsync를 사용하여 구 서버 /home/rocky 경로를 신 서버의 동일한 경로에 이관하는 명령어</span>\n$ <span class=\"token function\">rsync</span> <span class=\"token parameter variable\">-avzh</span> <span class=\"token parameter variable\">--delete</span> /home/rocky root@<span class=\"token operator\">&lt;</span>NEW_SERVER_IP<span class=\"token operator\">></span>:/home</code></pre></div>\n<p><strong>단, 두 서버의 캐릭터셋이 다른 경우 rsync로 이관 시 한글파일명이 깨질 수 있음.</strong> 예를 들어 구 서버의 캐릭터셋이 EUC-KR이고 신 서버의 캐릭터셋이 UTF-8인 경우 한글파일명이 깨짐. 파일명이 깨지는 파일이 적으면 FTP로 재업로드 하거나, 너무 많으면 <code class=\"language-text\">convmv</code> 명령어를 사용해볼 수 있을 것 같은데... 써보진 않음.</p>\n<h2 id=\"4-애플리케이션-기동-테스트\" style=\"position:relative;\"><a href=\"#4-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EA%B8%B0%EB%8F%99-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"4 애플리케이션 기동 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 애플리케이션 기동 테스트</h2>\n<p>아마도 제일 오래 걸릴 단계. 어떤 오류가 나올지 모르기 때문. 로그 보면서 오류를 하나하나 잡아가야 함.</p>\n<p>이 단계 실패하면 이관 못 하는 거임... 😭</p>\n<p>작업하면서 겪었던 오류들과 해결법은 다음과 같음.</p>\n<h3 id=\"rsync-연결-시-no-hostkey-alg-오류-발생\" style=\"position:relative;\"><a href=\"#rsync-%EC%97%B0%EA%B2%B0-%EC%8B%9C-no-hostkey-alg-%EC%98%A4%EB%A5%98-%EB%B0%9C%EC%83%9D\" aria-label=\"rsync 연결 시 no hostkey alg 오류 발생 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>rsync 연결 시 no hostkey alg 오류 발생</h3>\n<p>CentOS 6 서버에서 Rocky Linux 9 서버로 rsync 연결 시 no hostkey alg 오류가 발생함.</p>\n<p>Rocky Linux 9 서버에서 <code class=\"language-text\">update-crypto-policies --set LEGACY</code> 명령어 실행 후 재기동하면 해결됨.</p>\n<p>다시 원복하려면 <code class=\"language-text\">update-crypto-policies --set DEFAULT</code> 명령어 실행 후 재기동.</p>\n<h3 id=\"openjdk-17-라이브러리-의존성-오류-발생\" style=\"position:relative;\"><a href=\"#openjdk-17-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%98%A4%EB%A5%98-%EB%B0%9C%EC%83%9D\" aria-label=\"openjdk 17 라이브러리 의존성 오류 발생 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenJDK 1.7 라이브러리 의존성 오류 발생</h3>\n<p>Rocky Linux 9 서버에서 OpenJDK 1.7 버전을 사용하는 Java 애플리케이션 실행 시 libgconf 의존성 오류가 발생하여 구 서버에 있던 <code class=\"language-text\">/usr/lib64/libgconf-2.so.4.1.5</code> 파일을 신 서버에 복사한 후 심볼릭 링크를 만들어 해결함.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">ln</span> <span class=\"token parameter variable\">-s</span> /usr/lib64/libgconf-2.so.4.1.5 /usr/lib64/libgconf-2.so.4  <span class=\"token comment\"># 심볼릭 링크 생성</span>\n$ <span class=\"token function\">ls</span> <span class=\"token parameter variable\">-alrt</span> libgconf-2.so.4.1.5   <span class=\"token comment\"># 생성 확인</span>\n$ <span class=\"token function\">chmod</span> <span class=\"token number\">755</span> libgconf-2.so.4.1.5  <span class=\"token comment\"># 권한 설정</span></code></pre></div>\n<h3 id=\"web-was-서버에-별다른-오류-로그가-없음에도-404-not-found-에러-발생\" style=\"position:relative;\"><a href=\"#web-was-%EC%84%9C%EB%B2%84%EC%97%90-%EB%B3%84%EB%8B%A4%EB%A5%B8-%EC%98%A4%EB%A5%98-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%97%86%EC%9D%8C%EC%97%90%EB%8F%84-404-not-found-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D\" aria-label=\"web was 서버에 별다른 오류 로그가 없음에도 404 not found 에러 발생 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>WEB, WAS 서버에 별다른 오류 로그가 없음에도 404 Not Found 에러 발생</h3>\n<p>알고보니 신 서버로 이관 안 된 데이터가 있었음...</p>\n<h3 id=\"특정-기능이-됐었는데요-안됐습니다\" style=\"position:relative;\"><a href=\"#%ED%8A%B9%EC%A0%95-%EA%B8%B0%EB%8A%A5%EC%9D%B4-%EB%90%90%EC%97%88%EB%8A%94%EB%8D%B0%EC%9A%94-%EC%95%88%EB%90%90%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"특정 기능이 됐었는데요 안됐습니다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>특정 기능이 됐었는데요. 안됐습니다...</h3>\n<p>JEUS 기반 홈페이지의 특정 기능이 됐다가 안 되는 경우가 있어서 알아보니 JEUS 설치경로 소유자가 jeus가 아닌 root로 변경되어 있었음. JEUS 기동 후 모종의 실수(?)로 JEUS가 설치된 경로의 소유자를 바꿔버린 듯...</p>\n<p>소유자를 올바르게 변경하여 해결.</p>\n<h2 id=\"5-데이터-최종-이관\" style=\"position:relative;\"><a href=\"#5-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B5%9C%EC%A2%85-%EC%9D%B4%EA%B4%80\" aria-label=\"5 데이터 최종 이관 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 데이터 최종 이관</h2>\n<p>구 서버와 신 서버의 애플리케이션(WEB, WAS, DB 등)을 종료한 후 rsync를 사용하여 최종 데이터 이관.</p>\n<h2 id=\"6-실제-서비스-ip로-변경\" style=\"position:relative;\"><a href=\"#6-%EC%8B%A4%EC%A0%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-ip%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"6 실제 서비스 ip로 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 실제 서비스 IP로 변경</h2>\n<p>구 서버의 IP를 신 서버에 그대로 사용하려는 경우 <code class=\"language-text\">ifdown</code> 등의 명령어를 사용하여 구 서버의 네트워크를 종료한 후 신 서버의 IP를 구 서버의 IP로 변경.</p>\n<p>이제 신 서버의 애플리케이션(WEB, WAS, DB 등) 기동하고 정상작동 여부 테스트 해주면 끝임. 😄</p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%A3%BC%EC%9A%94-%EC%A0%88%EC%B0%A8\">주요 절차</a></p>\n</li>\n<li>\n<p><a href=\"#1-%EA%B0%80%EC%83%81%ED%99%94-%EC%84%9C%EB%B2%84-%EC%83%9D%EC%84%B1\">1. 가상화 서버 생성</a></p>\n</li>\n<li>\n<p><a href=\"#2-rocky-linux-9-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EA%B8%B0%EB%B3%B8-%EC%84%A4%EC%A0%95\">2. Rocky Linux 9 설치 및 기본 설정</a></p>\n<ul>\n<li><a href=\"#%EC%9C%A0%EC%A0%80-%EC%83%9D%EC%84%B1\">유저 생성</a></li>\n<li><a href=\"#%EC%9E%84%EC%8B%9C-ip-%EB%B6%80%EC%97%AC\">임시 IP 부여</a></li>\n<li><a href=\"#%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%84%A4%EC%A0%95\">네트워크 설정</a></li>\n<li><a href=\"#%ED%98%B8%EC%8A%A4%ED%8A%B8%EB%84%A4%EC%9E%84-%EC%84%A4%EC%A0%95\">호스트네임 설정</a></li>\n<li><a href=\"#ntp-%EC%84%A4%EC%A0%95\">NTP 설정</a></li>\n<li><a href=\"#ulimit-open-files-%EA%B0%92-%EC%84%A4%EC%A0%95\">ulimit open files 값 설정</a></li>\n<li><a href=\"#%ED%8C%8C%EC%9D%BC%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EB%A7%88%EC%9A%B4%ED%8A%B8\">파일시스템 생성 및 마운트</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B5%9C%EC%B4%88-%EC%9D%B4%EA%B4%80\">3. 데이터 최초 이관</a></p>\n</li>\n<li>\n<p><a href=\"#4-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EA%B8%B0%EB%8F%99-%ED%85%8C%EC%8A%A4%ED%8A%B8\">4. 애플리케이션 기동 테스트</a></p>\n<ul>\n<li><a href=\"#rsync-%EC%97%B0%EA%B2%B0-%EC%8B%9C-no-hostkey-alg-%EC%98%A4%EB%A5%98-%EB%B0%9C%EC%83%9D\">rsync 연결 시 no hostkey alg 오류 발생</a></li>\n<li><a href=\"#openjdk-17-%EB%9D%BC%EC%9D%B4%EB%B8%8C%EB%9F%AC%EB%A6%AC-%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%98%A4%EB%A5%98-%EB%B0%9C%EC%83%9D\">OpenJDK 1.7 라이브러리 의존성 오류 발생</a></li>\n<li><a href=\"#web-was-%EC%84%9C%EB%B2%84%EC%97%90-%EB%B3%84%EB%8B%A4%EB%A5%B8-%EC%98%A4%EB%A5%98-%EB%A1%9C%EA%B7%B8%EA%B0%80-%EC%97%86%EC%9D%8C%EC%97%90%EB%8F%84-404-not-found-%EC%97%90%EB%9F%AC-%EB%B0%9C%EC%83%9D\">WEB, WAS 서버에 별다른 오류 로그가 없음에도 404 Not Found 에러 발생</a></li>\n<li><a href=\"#%ED%8A%B9%EC%A0%95-%EA%B8%B0%EB%8A%A5%EC%9D%B4-%EB%90%90%EC%97%88%EB%8A%94%EB%8D%B0%EC%9A%94-%EC%95%88%EB%90%90%EC%8A%B5%EB%8B%88%EB%8B%A4\">특정 기능이 됐었는데요. 안됐습니다...</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#5-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B5%9C%EC%A2%85-%EC%9D%B4%EA%B4%80\">5. 데이터 최종 이관</a></p>\n</li>\n<li>\n<p><a href=\"#6-%EC%8B%A4%EC%A0%9C-%EC%84%9C%EB%B9%84%EC%8A%A4-ip%EB%A1%9C-%EB%B3%80%EA%B2%BD\">6. 실제 서비스 IP로 변경</a></p>\n</li>\n</ul>","frontmatter":{"title":"CentOS 서버를 Rocky Linux 9 서버로 이관 과정 정리","description":"CentOS 서버를 Rocky Linux 9 서버로 이관 과정 정리","date":"October 28, 2024","tags":["system","linux"],"series":"시스템 관리","previewImage":"system.jpg","isPrivate":null}},"previous":{"fields":{"slug":"/travel/2024-09-chuseok-travel/"},"frontmatter":{"title":"2024년 9월 추석연휴 병맛 여행기(홍천 계곡, 포천 출렁다리)","isPrivate":null}},"next":null},"pageContext":{"id":"abbbc771-02f6-584b-bef6-cef69f320ff5","previousPostId":"b6bb6232-b9d4-5a33-b8bd-aacccc19b2ad","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}